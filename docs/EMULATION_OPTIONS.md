# ĞĞ¿Ñ†Ğ¸Ğ¸ ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ STM32 Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ±ĞµĞ· Ğ¶ĞµĞ»ĞµĞ·Ğ°

ĞĞ±Ğ·Ğ¾Ñ€ Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ STM32G431CB Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ firmware Ğ±ĞµĞ· Ñ„Ğ¸Ğ·Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ¶ĞµĞ»ĞµĞ·Ñƒ.

## ğŸ“Š Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°

| Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ | Ğ¦ĞµĞ½Ğ° | Rust Support | STM32G4 | ĞŸĞµÑ€Ğ¸Ñ„ĞµÑ€Ğ¸Ñ | CI/CD | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ |
|---------|------|--------------|---------|-----------|-------|--------------|
| **Renode** | Free | âœ… Excellent | âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ | ğŸŸ¢ 90% | âœ… Ğ”Ğ° | **ğŸ¥‡ BEST** |
| QEMU | Free | âœ… Good | âš ï¸ Ğ§Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ°Ñ | ğŸŸ¡ 50% | âœ… Ğ”Ğ° | ğŸ¥ˆ OK |
| Mock HAL | Free | âœ… Native | âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ | ğŸŸ¢ 100% | âœ… Ğ”Ğ° | ğŸ¥‰ Complement |
| STM32CubeIDE | Free | âŒ C only | âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ | ğŸŸ¢ 95% | âŒ ĞĞµÑ‚ | âŒ No Rust |
| Keil MDK-ARM | â‚¬â‚¬â‚¬â‚¬ | âŒ C only | âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ | ğŸŸ¢ 99% | âš ï¸ Limited | âŒ Expensive |
| IAR EWARM | â‚¬â‚¬â‚¬â‚¬ | âŒ C only | âœ… ĞŸĞ¾Ğ»Ğ½Ğ°Ñ | ğŸŸ¢ 99% | âš ï¸ Limited | âŒ Expensive |
| Proteus | â‚¬â‚¬â‚¬ | âš ï¸ Limited | âš ï¸ Partial | ğŸŸ¡ 60% | âŒ ĞĞµÑ‚ | âš ï¸ Hardware focus |

## ğŸ¥‡ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: Renode (ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾!)

### âœ… ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Renode:

1. **Open Source** - Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹
2. **Rust-friendly** - Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Embassy framework
3. **STM32G4 support** - Ğ²ÑĞµ Ğ½ÑƒĞ¶Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€Ğ¸Ñ„ĞµÑ€Ğ¸Ğ¹Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
4. **Scriptable** - Python/Robot Framework Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
5. **CI/CD ready** - Ğ»ĞµĞ³ĞºĞ¾ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ² GitHub Actions
6. **Multi-device** - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ¾Ğ´ Ğ½Ğ° CAN-ÑˆĞ¸Ğ½Ğµ
7. **Active development** - Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Antmicro

### ğŸ“¦ Ğ§Ñ‚Ğ¾ ÑƒĞ¶Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:

```
âœ… renode/stm32g431cb.repl           - Platform description
âœ… renode/stm32g431_foc.resc         - Startup script
âœ… renode/tests/*.robot              - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹
âœ… .github/workflows/renode-ci.yml   - CI/CD pipeline
âœ… renode/manual_test.sh             - Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
âœ… renode/README.md                  - Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
âœ… EMULATION_QUICKSTART.md           - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚
```

### ğŸš€ Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚:

```bash
# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° (1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°)
wget https://github.com/renode/renode/releases/download/v1.15.0/renode_1.15.0_amd64.deb
sudo apt install -y mono-complete && sudo dpkg -i renode_*.deb

# Ğ—Ğ°Ğ¿ÑƒÑĞº (30 ÑĞµĞºÑƒĞ½Ğ´)
cargo build --target thumbv7em-none-eabihf
renode renode/stm32g431_foc.resc
```

**Ğ¡Ğ¼. `EMULATION_QUICKSTART.md` Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹.**

---

## ğŸ¥ˆ ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ° #1: QEMU

### ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:
ĞŸĞ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğ¹ open-source ÑĞ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€, Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ ARM Cortex-M.

### âœ… ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:
- Ğ¡Ñ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ñ€ĞµĞ¼ĞµĞ½ĞµĞ¼
- Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ (native execution)
- Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğµ ĞºĞ¾Ğ¼ÑŒÑĞ½Ğ¸Ñ‚Ğ¸

### âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:
- STM32G4 Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾
- ĞœĞ½Ğ¾Ğ³Ğ¸Ğµ Ğ¿ĞµÑ€Ğ¸Ñ„ĞµÑ€Ğ¸Ğ¹Ğ½Ñ‹Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ½Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹:
  - âŒ CORDIC (ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ G4)
  - âŒ FMAC (ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ G4)
  - âš ï¸ FDCAN (Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°)
- ĞœĞµĞ½ÑŒÑˆĞµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ´Ğ»Ñ ÑĞ¸Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ Ñ„Ğ¸Ğ·Ğ¸ĞºĞ¸

### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°:

```bash
sudo apt-get install qemu-system-arm
```

### Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:

```bash
# STM32 boards Ğ² QEMU
qemu-system-arm -M help | grep -i stm32

# Ğ—Ğ°Ğ¿ÑƒÑĞº (ĞµÑĞ»Ğ¸ board Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ)
qemu-system-arm \
  -M stm32vldiscovery \
  -kernel target/thumbv7em-none-eabihf/debug/joint_firmware \
  -nographic \
  -semihosting
```

### ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:
- Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸
- Ğ”Ğ»Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ±ĞµĞ· Ğ¿ĞµÑ€Ğ¸Ñ„ĞµÑ€Ğ¸Ğ¸
- Ğ•ÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ° ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ QEMU workflows

---

## ğŸ¥‰ ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ° #2: Mock HAL (Ğ²Ğ°Ñˆ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´)

### ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:
ĞĞ±ÑÑ‚Ñ€Ğ°Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Hardware Abstraction Layer Ñ‡ĞµÑ€ĞµĞ· traits Ğ´Ğ»Ñ unit-Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° host Ğ¼Ğ°ÑˆĞ¸Ğ½Ğµ.

### âœ… ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:
- **Ğ£Ğ¶Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ!** (56+ unit Ñ‚ĞµÑÑ‚Ğ¾Ğ²)
- Ğ¡Ğ°Ğ¼Ñ‹Ğ¹ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ (native x86_64)
- 100% ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ
- Ğ˜Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ Ğ´Ğ»Ñ TDD
- ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²

### âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:
- ĞĞµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¶ĞµĞ»ĞµĞ·Ğ¾
- Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ mocks Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
- ĞĞµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ timing constraints
- ĞĞµ ÑĞ¼ÑƒĞ»Ğ¸Ñ€ÑƒĞµÑ‚ hardware bugs

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸Ğ· Ğ²Ğ°ÑˆĞµĞ³Ğ¾ ĞºĞ¾Ğ´Ğ°:

```rust
// tests/integration_test.rs
#[test]
fn test_cascaded_control_chain() {
    let mut pos_ctrl = PositionController::new(Default::default());
    let mut vel_ctrl = VelocityController::new(Default::default());
    
    pos_ctrl.set_target(I16F16::from_num(1.0));
    let vel_setpoint = pos_ctrl.update(I16F16::ZERO);
    
    assert!(vel_setpoint > I16F16::ZERO);
}
```

### Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ:

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ mock Ğ´Ğ»Ñ Transport:

```rust
// src/firmware/transport/mock.rs
#[cfg(test)]
pub struct MockTransport {
    rx_queue: VecDeque<Message>,
    tx_queue: VecDeque<Message>,
}

#[cfg(test)]
impl Transport for MockTransport {
    fn send_message(&mut self, msg: &Message) -> Result<()> {
        self.tx_queue.push_back(msg.clone());
        Ok(())
    }
    
    fn receive_message(&mut self) -> Result<Option<Message>> {
        Ok(self.rx_queue.pop_front())
    }
}

#[cfg(test)]
mod tests {
    #[test]
    fn test_irpc_roundtrip() {
        let mut transport = MockTransport::new();
        let bridge = JointFocBridge::new(0x10);
        
        // Inject command
        transport.rx_queue.push_back(
            Message::new_joint_command(0x10, JointCommand::SetPosition {
                position: 1.57,
                max_velocity: None,
            })
        );
        
        // Process
        if let Ok(Some(msg)) = transport.receive_message() {
            if let Some(resp) = bridge.handle_message(&msg) {
                transport.send_message(&resp).unwrap();
            }
        }
        
        // Verify response sent
        assert_eq!(transport.tx_queue.len(), 1);
    }
}
```

### ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:
- Ğ”Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ğ¾Ğ²
- TDD approach
- Unit Ñ‚ĞµÑÑ‚Ñ‹ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- **Ğ’ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğº Renode, Ğ½Ğµ Ğ²Ğ¼ĞµÑÑ‚Ğ¾!**

---

## âŒ ĞĞµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‚ Ğ´Ğ»Ñ Rust

### STM32CubeIDE

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- ĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° C/C++
- Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Rust Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ğ¸ĞºĞ°Ğ¼Ğ¸
- ĞšĞ¾Ğ´Ğ¾Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ C ĞºĞ¾Ğ´

**Ğ’ĞµÑ€Ğ´Ğ¸ĞºÑ‚:** âŒ ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ

### Keil MDK-ARM / IAR Embedded Workbench

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ Ğ»Ğ¸Ñ†ĞµĞ½Ğ·Ğ¸Ğ¸ (â‚¬2000+)
- C/C++ toolchain only
- ĞĞµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ Rust Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
- ĞĞµÑ‚ CI/CD Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

**Ğ’ĞµÑ€Ğ´Ğ¸ĞºÑ‚:** âŒ Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ¸ Ğ½ĞµÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾

### Proteus

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:**
- Ğ¤Ğ¾ĞºÑƒÑ Ğ½Ğ° ÑÑ…ĞµĞ¼Ğ¾Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞµ, Ğ½Ğµ software
- ĞŸĞ»Ğ¾Ñ…Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° modern MCU
- ĞĞµÑ‚ Rust support
- ĞšĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¸Ğ¹ (â‚¬â‚¬â‚¬)

**Ğ’ĞµÑ€Ğ´Ğ¸ĞºÑ‚:** âš ï¸ Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ° Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ…ĞµĞ¼Ñ‹

---

## ğŸ¯ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµĞ¼Ğ°Ñ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ (Ğ³Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ°Ñ)

### Ğ”Ğ»Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ **Ñ‚Ñ€Ğ¸ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 1: Unit Tests (Mock HAL)                             â”‚
â”‚ âœ… Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ: 56+ Ñ‚ĞµÑÑ‚Ğ¾Ğ²                                     â”‚
â”‚ ğŸ¯ Ğ¦ĞµĞ»ÑŒ: Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°, Ğ°Ğ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼Ñ‹                          â”‚
â”‚ âš¡ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: ĞœĞ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 2: Integration Tests (Renode)                        â”‚
â”‚ âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‡Ñ‚Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¾!                                      â”‚
â”‚ ğŸ¯ Ğ¦ĞµĞ»ÑŒ: ĞŸĞµÑ€Ğ¸Ñ„ĞµÑ€Ğ¸Ñ, timing, Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»                       â”‚
â”‚ âš¡ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: Ğ¡ĞµĞºÑƒĞ½Ğ´Ñ‹                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Level 3: Hardware Tests (Real STM32)                       â”‚
â”‚ â³ ĞšĞ¾Ğ³Ğ´Ğ° Ğ¶ĞµĞ»ĞµĞ·Ğ¾ Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚                                      â”‚
â”‚ ğŸ¯ Ğ¦ĞµĞ»ÑŒ: Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ, Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ñ‚Ğ¾Ñ€              â”‚
â”‚ âš¡ Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ: ĞœĞ¸Ğ½ÑƒÑ‚Ñ‹ (setup time)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Workflow:

```bash
# 1. Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ¸Ñ‡Ğ¸
# - ĞŸĞ¸ÑˆĞ¸Ñ‚Ğµ ĞºĞ¾Ğ´
# - Unit Ñ‚ĞµÑÑ‚Ñ‹ Ñ mock (Level 1)
cargo test --lib

# 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
# - Renode ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ñ (Level 2)
./renode/manual_test.sh all

# 3. Push Ğ² GitHub
# - CI Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Level 1 + Level 2
git push

# 4. ĞšĞ¾Ğ³Ğ´Ğ° Ğ¶ĞµĞ»ĞµĞ·Ğ¾ Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚
# - Flash Ğ¸ Ñ‚ĞµÑÑ‚ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ STM32 (Level 3)
probe-rs run --chip STM32G431CB target/.../firmware
```

---

## ğŸ“Š Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°

### Ğ‘ĞµĞ· ÑĞ¼ÑƒĞ»ÑÑ†Ğ¸Ğ¸ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¶ĞµĞ»ĞµĞ·Ğ¾):
```
Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ¸Ñ‡Ğ¸:        2 Ñ‡Ğ°ÑĞ°
ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¶ĞµĞ»ĞµĞ·Ğ°:        âŒ 4-12 Ğ½ĞµĞ´ĞµĞ»ÑŒ
Flash + debug:          30 Ğ¼Ğ¸Ğ½ÑƒÑ‚
Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:                  âŒ ĞœĞ•Ğ¡Ğ¯Ğ¦Ğ«
```

### Ğ¡ Renode:
```
Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ¸Ñ‡Ğ¸:        2 Ñ‡Ğ°ÑĞ°
Unit Ñ‚ĞµÑÑ‚Ñ‹:             10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
Renode Ñ‚ĞµÑÑ‚Ñ‹:           5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
CI/CD:                  5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)
Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:                  âœ… ~2.5 Ñ‡Ğ°ÑĞ°
```

**Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸: 99%** ğŸš€

---

## ğŸ› ï¸ Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

### GDB + Renode

Renode Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ GDB Ğ´Ğ»Ñ step-by-step debugging:

```bash
# Terminal 1: Renode Ñ GDB server
renode renode/stm32g431_foc.resc

# Terminal 2: GDB
arm-none-eabi-gdb target/thumbv7em-none-eabihf/debug/joint_firmware
(gdb) target remote :3333
(gdb) break main
(gdb) continue
```

### RTT Ğ´Ğ»Ñ defmt

Renode Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿ĞµÑ€ĞµÑ…Ğ²Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ RTT Ğ´Ğ»Ñ Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ defmt Ğ»Ğ¾Ğ³Ğ¾Ğ²:

```bash
# Ğ’ Renode console
(monitor) machine CreateRttChannel "defmt" 0
(monitor) showAnalyzer sysbus.rtt
```

### Trace & Profile

Renode ÑƒĞ¼ĞµĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ:

```bash
(monitor) cpu CreateExecutionTracing "trace" $ORIGIN/trace.log
(monitor) cpu EnableExecutionTracing
(monitor) emulation RunFor "00:00:01"
(monitor) cpu DisableExecutionTracing

# ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ trace.log
```

---

## ğŸ“š Ğ ĞµÑÑƒÑ€ÑÑ‹

### Renode:
- ĞÑ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ°Ğ¹Ñ‚: https://renode.io/
- Documentation: https://renode.readthedocs.io/
- GitHub: https://github.com/renode/renode
- Examples: https://github.com/renode/renode/tree/master/platforms

### QEMU:
- Documentation: https://www.qemu.org/docs/master/
- STM32 support: https://github.com/beckus/qemu_stm32

### Embedded Rust:
- Embassy: https://embassy.dev/
- Embedded Book: https://docs.rust-embedded.org/book/
- defmt: https://defmt.ferrous-systems.com/

---

## âœ… Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ

### Ğ”Ğ»Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ STM32G431CB FOC Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°:

**1. PRIMARY: Renode** â† **Ğ£Ğ–Ğ• ĞĞĞ¡Ğ¢Ğ ĞĞ•Ğ!**
   - Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ğ¹Ñ‚Ğµ: `./renode/manual_test.sh`
   - CI/CD Ğ³Ğ¾Ñ‚Ğ¾Ğ²: `.github/workflows/renode-ci.yml`

**2. COMPLEMENT: Mock HAL** â† **Ğ£Ğ–Ğ• Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ•Ğ¢Ğ¡Ğ¯!**
   - ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ unit Ñ‚ĞµÑÑ‚Ñ‹
   - Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ²ÑĞ·ÑŒ

**3. FUTURE: Real Hardware**
   - ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚ Ğ¶ĞµĞ»ĞµĞ·Ğ¾
   - Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ

### ĞĞµ Ñ‚Ñ€Ğ°Ñ‚ÑŒÑ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ½Ğ°:
- âŒ QEMU (Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° G4)
- âŒ ĞšĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¸Ğµ IDE (Ğ½Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ Ñ Rust)
- âŒ Proteus (Ğ½Ğµ Ğ´Ğ»Ñ software)

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2025-10-03  
**ĞŸÑ€Ğ¾ĞµĞºÑ‚:** STM32G431CB FOC Motor Controller  
**Framework:** Embassy + iRPC  
**Ğ­Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ:** Renode 1.15.0

